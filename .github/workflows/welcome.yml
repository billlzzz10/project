name: Welcome New Contributors

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

permissions:
  issues: write
  pull-requests: write

jobs:
  welcome:
    runs-on: ubuntu-latest
    steps:
      - name: Welcome new contributors
        uses: actions/github-script@v7
        with:
          script: |
            // Check if this is the user's first issue/PR
            const { data: issues } = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              creator: context.payload.sender.login,
              state: 'all'
            });
            
            const { data: prs } = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'all'
            });
            
            const userPrs = prs.filter(pr => pr.user.login === context.payload.sender.login);
            const isFirstContribution = issues.length <= 1 && userPrs.length <= 1;
            
            if (isFirstContribution) {
              const welcomeMessage = `## ðŸ‘‹ Welcome to AI Business App!

              Thank you for your ${context.eventName === 'issues' ? 'issue' : 'pull request'}! 

              ${context.eventName === 'issues' ? 
                `We appreciate you taking the time to report this. A maintainer will review it soon.

              ### What happens next?
              - ðŸ·ï¸ Your issue will be automatically labeled
              - ðŸ‘€ A maintainer will review and respond
              - ðŸ”„ We may ask for additional information
              
              ### While you wait
              - ðŸ“š Check out our [documentation](https://billlzzz10.github.io/project)
              - ðŸ’¬ Join the [discussions](https://github.com/billlzzz10/project/discussions)
              - â­ Star the repository if you find it useful!` :
                `We're excited to review your contribution!

              ### What happens next?
              - ðŸ·ï¸ Your PR will be automatically labeled
              - ðŸ” Automated checks will run
              - ðŸ‘€ A maintainer will review your changes
              - ðŸ”„ We may request changes or ask questions
              
              ### Make sure to
              - âœ… Check that all CI checks pass
              - ðŸ“ Update documentation if needed
              - âœ… Add tests for new functionality
              - ðŸ”„ Respond to any feedback from reviewers`}

              Thank you for contributing to open source! ðŸŽ‰`;

              await github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: welcomeMessage
              });
              
              // Add first-time-contributor label
              await github.rest.issues.addLabels({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                labels: ['first-time-contributor']
              });
            }